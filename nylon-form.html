<link rel="import" href="../polymer/polymer-element.html">

<script>
    class NylonForm extends Polymer.Element {
        static get is() {
            return 'nylon-form';
        }

        static get template() {
            return Polymer.html`
                <slot></slot>
            `
        }


        submit(){
            
            let data = {}

            for(let i=0;i<this.children.length;i++){
                let path = this.children[i].getAttribute('form-path')
                if(path!=null){
                    let prop = "value"
                    if(this.children[i].getAttribute('form-prop')!=null){
                        prop = this.children[i].getAttribute('form-prop')
                    }

                   

                    let stackPath = ""
                    
                    if(path.split('.').length>1){
                        
                        path.split('.').map((key,index)=>{
                            stackPath = stackPath+"."+key
                            eval('data'+stackPath+'='+ 'data'+stackPath+' || {}')
                        })
                       
                    }else{
                        stackPath = path
                    }

                    let valData = ""
                    if(this.children[i].getAttribute('form-child')!=null){

                        if(this.children[i].localName=="nylon-form"){
                            this.children[i].submit()
                            valData = this.children[i].data
                        }else{
                            this.children[i].shadowRoot.querySelector("nylon-form").submit()
                            valData = this.children[i].shadowRoot.querySelector("nylon-form").data
                        }
                        
                    }else{
                        valData = this.children[i][prop]
                    }

                    eval('data.' + path + '='+JSON.stringify(valData))

                }
                
            }

            this.data = data

            return data
        }


    }
    window.customElements.define(NylonForm.is, NylonForm);


  
</script>